{% extends 'articles/base.html' %}
{% load i18n humanize %}

{% block title %}{% trans article.title %}{% endblock %}

{% block content %}
<div id="article-content" class="article">
    <h2 class="title">{% trans article.title %}</h2>

    {{ article.rendered_content|safe }}
</div>

<div id="article-meta">
    <h4>Meta</h4>

    <p><strong>{% trans 'Published' %}</strong>: {{ article.publish_date|naturalday }}</p>

    <p><strong>{% trans 'Author' %}</strong>: <a href="{% url articles_by_author article.author.username %}" title="{% trans 'Read other articles by this author' %}">{{ article.author.get_name }}</a></p>

    <p><strong>{% trans 'Comments' %}</strong>: <a href="#disqus_thread">&nbsp;</a></p>

    <p><strong>{% trans 'Word Count' %}</strong>: {{ article.word_count|intcomma }}</p>

    {% if article.get_next_article %}
    <p>
        <strong>{% trans 'Next' %}</strong>:
        <a href="{{ article.get_next_article.get_absolute_url }}">{{ article.get_next_article.title }}</a>
    </p>
    {% endif %}

    {% if article.get_previous_article %}
    <p>
        <strong>{% trans 'Previous' %}</strong>:
        <a href="{{ article.get_previous_article.get_absolute_url }}">{{ article.get_previous_article.title }}</a>
    </p>
    {% endif %}

    {% if article.use_addthis_button and article.addthis_username %}
    <!-- AddThis Button BEGIN -->
    <div>
        <script type="text/javascript">var addthis_pub="{{ article.addthis_username }}";</script>
        <a href="http://www.addthis.com/bookmark.php?v=20" onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')" onmouseout="addthis_close()" onclick="return addthis_sendto()"><img src="http://s7.addthis.com/static/btn/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>
        <script type="text/javascript" src="http://s7.addthis.com/js/200/addthis_widget.js"></script>
    </div>
    <!-- AddThis Button END -->
    {% endif %}

    <script type="text/javascript" src="http://tweetmeme.com/i/scripts/button.js"></script>

    <h4>{% trans 'Filed Under' %}</h4>
    <p>{% if article.categories.count %}{% for category in article.categories.all %}{% if not forloop.first %}{% ifnotequal article.categories.count 2 %},{% endifnotequal %} {% if forloop.last %}{% trans 'and' %}{% endif %} {% endif %}<a href="{% url articles_display_category category.slug %}" title="{% trans 'View all articles in this category' %}">{{ category }}</a>{% endfor %}{% else %}<a href="{% url articles_display_category 'uncategorized' %}" title="{% trans 'View all uncategorized articles' %}">{% trans 'Uncategorized' %}</a>{% endif %}</p>

    {% for fu in article.followups.active %}
    {% if forloop.first %}<h4 class="hasfollowup-header">{% trans 'Follow-Up Articles' %}</h4>

    <ul class="followups">{% endif %}
        <li>
            <a href="{{ fu.get_absolute_url }}" title="{% trans 'Read this follow-up article' %}">{{ fu.title }}</a>, {% trans 'posted' %} {{ fu.publish_date|naturalday }}
        </li>
    {% if forloop.last %}</ul>{% endif %}
    {% endfor %}

    {% for fu in article.followup_for.active %}
    {% if forloop.first %}<h4 class="followup-header">{% trans 'Follows Up On' %}</h4>

    <ul class="followups">{% endif %}
        <li>
            <a href="{{ fu.get_absolute_url }}" title="{% trans 'Read this article' %}">{{ fu.title }}</a>, {% trans 'posted' %} {{ fu.publish_date|naturalday }}
        </li>
    {% if forloop.last %}</ul>{% endif %}
    {% endfor %}

    {% for ra in article.related_articles.active %}
    {% if forloop.first %}<h4 class="related-header">{% trans 'Related Articles' %}</h4>

    <ul class="related-articles">{% endif %}
        <li>
            <a href="{{ ra.get_absolute_url }}" title="{% trans 'Read this related article' %}">{{ ra.title }}</a>, {% trans 'posted' %}  {{ ra.publish_date|naturalday }}
        </li>
    {% if forloop.last %}</ul>{% endif %}
    {% endfor %}

    {% for url,title in article.links %}
    {% if forloop.first %}<h4>{% trans 'Article Links' %}</h4>
    <ol>{% endif %}
        <li><a href="{{ url }}" title="{{ title }}">{{ title|safe|truncatewords:10 }}</a></li>
    {% if forloop.last %}</ol>{% endif %}
    {% endfor %}
</div>
<div class="clear"></div>

<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_identifier = {{ article.id }};
</script>
<script type="text/javascript" src="http://disqus.com/forums/{{ disqus_forum }}/embed.js"></script>
<noscript><a href="http://disqus.com/forums/{{ disqus_forum }}/?url=ref">View the discussion thread.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
//<![CDATA[
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
    if(links[i].href.indexOf('#disqus_thread') >= 0) {
        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
    }
    }
    document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/{{ disqus_forum }}/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>
{% endblock %}
